<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LocalBeat // Lobby</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div id="glitch-layer"></div>

    <div id="overlay-start" onclick="initExperience()">
        <h1 style="font-family:'Orbitron'; letter-spacing:5px;">CLICK TO INITIALIZE</h1>
    </div>

    <div id="dynamic-bg"></div>
    <canvas id="visualizer-canvas"></canvas>

    <div id="jukebox-notif" class="jukebox-notif">
        <div style="font-size:0.8rem; color:#888;">NOW PLAYING</div>
        <div id="bgm-title">Loading...</div>
    </div>

    <div class="landing-wrapper" id="content-wrapper">
        <div class="hero-title">LOCALBEAT</div>
        <div class="hero-subtitle">ARCHIVE SYSTEM V3.0</div>

        <div class="mode-selector">
            <div class="mode-btn active" onclick="selectMode('CLASSIC', this)">
                <h3>CLASSIC</h3>
                <p>MULTIPLE CHOICE</p>
            </div>
            <div class="mode-btn" onclick="selectMode('TYPING', this)">
                <h3>HARDCORE</h3>
                <p>TYPING TEST</p>
            </div>
        </div>

        <div style="display:flex; align-items:center; gap:10px; margin-bottom:30px;">
            <label>LENGTH:</label>
            <input type="range" id="q-count" min="10" max="50" step="10" value="10" oninput="document.getElementById('q-val').innerText=this.value">
            <span id="q-val" style="font-family:'Orbitron'">10</span>
        </div>

        <button class="btn-main" onclick="startGame()">START SESSION</button>
        
        <div style="margin-top:20px;">
            <button onclick="fetch('/shutdown', {method:'POST'}).then(()=>window.close())" style="background:none; border:none; color:#555; cursor:pointer;">QUIT</button>
        </div>
    </div>

    <audio id="bgm-player" crossorigin="anonymous"></audio>
    <script src="{{ url_for('static', filename='js/landing.js') }}"></script>
    <script>
        let selectedMode = 'CLASSIC';
        function selectMode(mode, el) {
            selectedMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
        function startGame() {
            const count = document.getElementById('q-count').value;
            // Glitch Transition
            document.getElementById('glitch-layer').classList.add('glitch-active');
            
            // Fade out audio
            const audio = document.getElementById('bgm-player');
            let vol = audio.volume;
            let fade = setInterval(() => {
                if(vol > 0.05) { vol -= 0.05; audio.volume = vol; }
                else {
                    clearInterval(fade);
                    window.location.href = `/quiz?count=${count}&mode=${selectedMode}`;
                }
            }, 30);
        }
    </script>
</body>
</html>